package com.app.ivoke.models;

import java.util.ArrayList;
import java.util.List;

import org.json.JSONArray;
import org.json.JSONObject;

import android.util.Log;

import com.app.ivoke.helpers.JsonHelper;
import com.app.ivoke.helpers.MessageHelper;
import com.app.ivoke.helpers.WebHelper.NetworkException;
import com.app.ivoke.objects.MuralPost;
import com.app.ivoke.objects.UserIvoke;
import com.google.android.gms.maps.model.LatLng;

public class MuralModel extends WebServer {
	
	public List<MuralPost> getNearbyPosts(LatLng pLatLng, int pDistance)
	{
		List<MuralPost> listMuralPosts = new ArrayList<MuralPost>();
		
		try {
			String retornoMuralPosts = 
					web.doRequest(site(URL_MURAL_POSTS_GET_NEARBY), 
					              web.makeListParameter("lat_lng_distance"
						                                , String.valueOf(pLatLng.latitude).replace(".",",") + ";" 
						                                + String.valueOf(pLatLng.longitude).replace(".",",") + ";"
						                                + String.valueOf(pDistance).replace(".",",")));
		
			try {
				 JSONArray jsonMuralPosts = new JSONArray(retornoMuralPosts);
				
				 for (int i = 0; i < jsonMuralPosts.length() ; i++) {
					 JSONObject jsonMuralPost = jsonMuralPosts.getJSONObject(i);
					 
					 J
					 
					 listMuralPosts.add(
							 new MuralPost(jsonMuralPost.getString(""), 
				                         pMensagem, 
				                         pQuando, 
				                         pIconeID)); 
					 
				 }
				  
				 listMuralPosts = ((List<MuralPost>) JsonHelper.toList(jsonMuralPosts));
				 Log.d("##DEBUG##", "MuralModel.getNearbyPosts cast successful!");
					
			} catch (Exception e) {
				Log.d("##ERRO##", "MuralModel.getNearbyPosts error:"+e.getMessage());
				wsLog("getNearbyPosts - Exception:"+e.getMessage());
				e.printStackTrace();
				
				return listMuralPosts;
		    }
			
			
		} catch (NetworkException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		
		return listMuralPosts;
	}
}
